{% extends "app/structure/layout.html" %} {% block content %}

<div class="content-padded flex flex-col gap-y-4">
  <!-- Header -->
  <div>
    <h1>{{ title }}</h1>
    <ul>
      <li>
        Current User:
        <b style="color: {{ user.profile.map_icon_color }}"
          >{{ request.user }}</b
        >
      </li>
      {% if request.user.is_staff %}
      <li>
        <a
          class="link"
          href="/admin/blog/profile/{{ request.user.profile.id }}/change/"
          target="_blank"
          >Edit Profile</a
        >
      </li>
      {% else %}
      <li>Contact site staff to help change you profile.</li>
      {% endif %}
      <a class="link" href="/manage/blog_post">Back to post list</a>
    </ul>
  </div>
  <!-- Side by Side Holder -->
  <div class="flex gap-x-4">
    <!-- Post Form -->
    <form
      class="
        w-72
        md:w-1/2
        max-w-xl
        bg-gray-100
        p-2
        md:p-4
        rounded
        flex flex-col
        gap-y-2
      "
      action="."
      method="post"
    >
      {% csrf_token %} {% for field in BlogPostForm %}
      <div>
        <div class="font-bold">{{ field.label_tag }}</div>
        <div>{{ field }}</div>
        <div class="field-validation-error">{{ field.errors }}</div>
      </div>
      {% endfor %}
      <div class="validation-summary-errors">{{ form.non_field_errors }}</div>
      <button class="btn-short btn-accent-dark" type="submit">Submit</button>
    </form>
    <!-- Post Preview -->
    <div class="flex flex-col w-full bg-gray-100 gap-y-2 p-2 md:p-4 rounded">
      <h2>Post Preview</h2>
      <div id="preview">
        {% include 'app/partials/story-header.html' %}
        <div class="post-content w-full max-w-4xl m-auto py-4 px-2">
          {% include 'app/partials/story-content.html' %}
          <div class="bg-gray-300 m-auto p-4 rounded">
            Like, Comment, Subscribe, and Share Buttnons will appear here
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("keyup", generate_preview);

  function generate_preview(e) {
    const post_id = "{{post.id}}";
    const previewFields = [
      "title",
      "subtitle",
      "participants",
      "event_date",
      "loc_name",
      "content",
    ];
    console.log(`Generating Preview for Post ID: ${post_id}`);

    for (const previewField of previewFields) {
      // Get value from form
      const formValue = document.getElementById(`id_${previewField}`).value;
      console.log(
        `[${previewField}] form value is:\n"${formValue.substring(0, 50)}"`
      );
      // Set value in preview
      const previewElement = document.getElementById(
        `post_${post_id}_${previewField}`
      );
      console.log(previewElement);
      previewElement.innerHTML = formValue;
    }
  }
</script>
{% endblock %}
